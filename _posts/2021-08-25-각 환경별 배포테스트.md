---
layout: post
title:  "환경별 디비 테스트"
date:   2021-08-26 00:20
categories: book, webflux
tags: [reactprogramming]
---

## RxJava7

### TestSubscriber / TestObserver
- 테스트 용도로 사용되는 소비자 클래스
- assertXXX로 데이터 검증
- awaitXXX 함수를 이용해서 지정된 시간동안 대기하거나 완료 또는 에러 이벤트가 발생할 때까지 대기할 수 있다.
- 완료 에러 구독 해지등의 결과 값을 이용해서 검증할 수 있다.

### assertEmpty
- 테스트 시점까지 통지받은 데이터가 없다면 성공
- 통지 이벤트 자체가 없을 때, 완료처리되도 실패한다.

```java

    // 테스트 실패 예제
    @Test
    public void getCarStreamEmptyFailTest(){
        // when

        Observable<Integer> observable1 = Observable.just(1,2,3,4,5);
        TestObserver<Integer> observer = observable1.test();

        // then
        observer.awaitDone(100L, TimeUnit.MILLISECONDS).assertEmpty();
    }

    // 테스트 성공 예제
    @Test
    public void getCarStreamEmptySuccessTest(){
        // when
        Observable<Integer> observable1 = Observable.just(1,2,3,4,5);
        TestObserver<Integer> observer = observable1.delay(1000L, TimeUnit.MILLISECONDS).test();

        // then
        observer.awaitDone(100L, TimeUnit.MILLISECONDS).assertEmpty();
    }
```

### assertValue & assertValues
- assertValue
    - 통지된 데이터가 한개의 경우 사용
- assertValues
    - 통지된 데이터가 한개 이상인 경우와 순서가 같을 때
- assertNoValues
    - 해당 시점까지 통지된 데이터가 없으면 성공
    - 완료 통지와 에러통지는 테스트 대상 제외

```java
    @Test
    public void assertValueTest(){
        Observable.just("a")
                .test()
                .assertValue("a");
    }

    @Test
    public void getCarMakerAssertValueTest(){

        Observable<String> observable = Observable.just("a", "B", "c", "D");

        observable
                .test()
                .awaitDone(1L, TimeUnit.MILLISECONDS)
                .assertValues("a", "B", "c", "D");
    }

    @Test
    public void assertNoValuesTest(){
        Observable.interval(200L, TimeUnit.MILLISECONDS)
                .doOnNext(data -> Logger.log(LogType.ON_NEXT, data))
                .filter(data -> data > 5)
                .test()
                .awaitDone(1000L, TimeUnit.MILLISECONDS)
                .assertNoValues();
    }
```








### 참고 
* <https://www.inflearn.com/course/%EC%9E%90%EB%B0%94-%EB%A6%AC%EC%95%A1%ED%8B%B0%EB%B8%8C%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D-2/lecture/53333?tab=curriculum>



