---
layout: post
title:  "Modern Java - 10"
date:   2022-01-04 11:20:21 +0900
categories: java
---

> 기본에 충실하자 - 10

# 함수형 관점으로 생각하기

### 시스템 구현과 유지보수
    - 함수형 프로그래밍이 제공하는 부작용 없음과 불변성이라는 개념은?
- 공유된 가변 데이터
    - 일반적으로 변수가 예상하지 못한 값을 갖는 이유는 우리가 유지보수하는 시스템의 여러 메서드에서 공유된 값을 읽고 갱신하기 때문이다.
    - 자신을 포함하는 클래스의 상태 그리고 다른 객체의 바꾸지않으며, return문을 통해서만 자신의 결과를 반환하는 메서드를 순수 메서드 또는 부작용이없는 메서드라고 부른다.
    - 부작용이란 함수내에 포함되지 못한 기능을 부작용이라고한다.
        - 자료구조를 고치거나 필드에 값을 할당
        - 예외발생
        - 파일에 쓰기 동의 I/O 동작 수행
    - 불변 객체를 활용하여 부작용을 없애는 방법
    - 불변객체는 인스턴스화 한 다음에 상태를 바꿀 수 없기 때문에 스레드의 안정성을 보장한다.

### 선언형 프로그래밍
- 일반적으로 프로그래밍 방식은 크게 두가지 방식으로 나뉜다. 순차적으로 작업을 처리하는 `HOW`에 집중된 방법과 질의문을 활용하는 `What`에 관점을 두는 방법
- 질의문 구현방법은 내부 반복을 사용하는데, 이러한 방법을 선언형 프로그래밍이라고한다. 선언형 프로그래밍은 우리가 원하는것이 무엇이고, 시스템이 어떻게 목표를 달성할 것인지 규칙을 정한다.

### 왜 함수형 프로그래밍인가
- 함수형 프로그래밍은 선언형 프로그래밍을 따르는 대표적인 방식이고, 부작용 없는 계산을 지향한다
- 부작용을 멀리한다는 것은 유지보수에 도움을 준다.

### 함수형 프로그래밍이란
- 함수를 활용하는 프로그래밍 기법
- 함수란 수학적인 의미의 함수와 같다. 0개 이상의 인수를 가지며 한 개 이상의 결과를 반환하지만 부작용이 없어야한다.


### 함수형 자바
- 실질적으로는 자바에서 완벽한 함수형 프로그래밍을 구현하기는 어렵다.
- 함수나 메서드는 지역변수만을 변경해야 함수형이라고 할 수 있다. 또한 참조하는 객체가 있다면 반드시 불변객체이어야 한다.
- 즉 모든 객체가 final이어야하고 모든 참조 필드는 불변객체를 직접 참조해야한다.
- 함수형이라면 함수나 메서드가 어떤 예외도 일으키지 않아야한다.
    - 예외가발생하면 return을 반활할 수 없다. => 함수형을 수학적으로 활용하는데 큰 걸림돌이 된다.
    - 수학적함수는 주어진 인수값에 대응하는 하나의 결과를 반환한다.
    - 모든 연산은 하나의 결과를 도출하는데, 이때 에러가 발생한다면 결과를 도출하지 못하게된다. 예외를 사용하지 않고 값을 도출하기 위해 Optional을 사용할 수 있다.
    - 모든 상황에 Optional을 사용하는 것이 아니라, 다른 컴포넌트에 영향을 미치지 않도록한다.
    - 마지막으로 비 함수형 동작을 감출 수 있는 상황에서만 부작용을 포함하는 라이브러리 함수를 사용해야한다.
    - 예) 컬렉션을 미리 복사하던가 발생할 수 있는 예제를 적절하게 내부에서 처리하는 방법

### 참조 투명성
- 부작용을 감춰야한다 라는 제약은 참조 투명성 개념으로 귀결된다.
- 같은 인수로 함수를 호출햇을 때 항상 같은 결과를 반환한다면 참조적으로 투명한 함수이다.
- 어떤 입력이 주어졌을 시, 어디서 호출하던 같은 결과를 생성해야한다.
- 참조 투명성은 비싸거나 오래 걸리는 연산에 대해 캐싱을 적용하는 성능 최적화 기능도 제공
- 자바에서는 참조 투명성과 같은 관련된 작은 문제가있다. List를 반환하는 메서드를 두 번 호출하면, 두 번의 호출결과로 같은 요소를 포함하지만 주솟값이 다른 리스트가 반환 된다
    - 결과 리스트가 가변객체라면 결론적으로 리스트를 반환하는 메서드는 참조적으로 투명하지 않은 메서드이다. 이때 결과 리스트가 불변 객체를 반환한다면 두 리스트의 참조 투명성이 보장
- 함수형 코드에서는 이런 함수를 참조적으로 투명한 것으로 본다

### 객체지향 프로그래밍과 함수형 프로그래밍
- 자바 8은 함수형 프로그래밍을 익스트림 객체지향 프로그래밍으로 간주한다.
- 자바 프로그래머는 무의식적으로 함수형 프로그래밍의 일부기능과 익스트림 객체지향 프로그래밍 일부 기능을 사용하게 된다.

### 재귀와 반복
- 순수 함수형 프로그래밍은 while, for 같은 반복문을 포함하지 않는다.
- 반복문을 사용하면 변화가 자연스럽게 코드에 반영될 수 있다. while loop 조건의 변경이 되는경우
- 함수형 스타일에서 다른 누군가가 변화를 알지 못한다면 아무 관계 없다고 한다
- 반복문을 사용하기 보다는 재귀호출을 이용하는 것이 공유 자원에 대한 부작용을 낮출 수 있다. 하지만 재귀호출은 memory 이슈가 발생할 가능성이 있는대, Tail call optimization 기법을 사용하여 해결 할 수 있다.

### 함수는 모든 곳에 존재
- 함수형 프로그래밍이란 함수나 메서드가 수학의 함수처럼 동작함을, 즉 부작용 없이 동작함을 의미한다.
- 함수형 프로그래밍에서는 함수를 마치 일반 값처럼 사용해서 인수로 전달하거나, 자료구조에 저장할 수 있음을 의미
- 일반값처럼 취급할 수 있는 함수를 일급함수 


### 고차원함수
- 함수값을 스트림의 처리연산으로 전달하거나, 메서드 참조를 활용하여 전달하는 등 동작 파라미터화를 달성하는 용도로만 사용
- 함수를 인수로 받아 새로운 함수를 만드는 정적 메서드 Comparator.comparing

```java
Comparator<Apple> c = comparing(Apple::getWeight);

Function<String, String> transformationPipeline = addHeader.andThen(Letter::checkSplelling)
                                                           .andThen(Letter::addFooter);


```

- Comparator.comparing 처럼 하나이상의 함수를 인수로받거나 함수의 결과로 반환을 받으면 고차원함수라고한다.

### 영속 자료구조
- 함수횽 프로그램에서는 함수형 자료구조, 불변 자료구조 등의 용어도 사용하지만 보통은 영속 자료구조라고 부른다.
- 함수형메서드에서는 전역 자료구조나 전달 된 구조를 갱신할 수 없다. 자료구조를 변경한다면 가은 메서드를 두번 호출했을 때 결과가 달라지므로 참조 투명성에 위배된다.
- 결과 자료구조를 바꾸지말아야 하는 것이 자료구조를 사용하는 모든 사용자에게 요구하는 단 한가지이다.

### 게으른 리스트
- 자바 8의 스트림은 게으르다.
- 자바 8의 스트림은 요청할때만 값을 생성한다.
- 스트림에게 연산이 주어진다면 연산이 수행되는것이 아니라 스트림에게 최종 연산을 적용하는 시점에 실제연산이 이루어진다.
